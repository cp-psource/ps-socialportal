function bp_get_cookies(){var e,t,i,n,a,s=document.cookie.split(";"),o={};for(e=0;e<s.length;e++)i=(t=s[e]).indexOf("="),n=jQuery.trim(unescape(t.slice(0,i))),a=unescape(t.slice(i+1)),0===n.indexOf("bp-")&&(o[n]=a);return encodeURIComponent(jQuery.param(o))}function bp_get_query_var(e,t){var i={};return(t=void 0===t?location.search.substr(1).split("&"):1<(t=t.split("?")).length?t[1].split("&"):[]).forEach(function(e){i[e.split("=")[0]]=e.split("=")[1]&&decodeURIComponent(e.split("=")[1])}),!(!i.hasOwnProperty(e)||null==i[e])&&i[e]}function clear(e){var t,i,n;if(e=document.getElementById(e)){if(t=e.getElementsByTagName("INPUT"),i=e.getElementsByTagName("OPTION"),n=0,t)for(n=0;n<t.length;n++)t[n].checked="";if(i)for(n=0;n<i.length;n++)i[n].selected=!1}}jQuery,window.CB={DOM:{},Feedback:{},Loader:{},Request:{},Message:{},Activity:{}},function(i){i(document).ready(function(){var e,t;i(document).on("click",".cb-close-notice",function(){return i(this).parents(".site-feedback-message").slideUp(150),!1}),(e=i("#site-header-row-main")).prev(".site-header-row").length&&e.find(".site-header-not-logged-in-link [data-balloon-pos]").each(function(){i(this).attr("data-balloon-pos","up")}),i(".bp-nav-tabs").each(function(){var e=i(this);e.hasClass("no-greedy-nav")||e.greedyNav({LinksSelector:"ul",buttonLabel:'<i class="fa fa-ellipsis-h" aria-hidden="true"></i>'})}),i(".bp-nav-tabs-style-icons-only a").each(function(){var e=i(this),t=e.parent();t.attr("aria-label",e.text()),t.attr("data-balloon-pos","up"),e.text("")}),"undefined"!=typeof WebuiPopovers&&(i(".account-nav-item>a, .notifications-nav-item>a").webuiPopover("destroy").webuiPopover({content:function(){return i(this).next(".header-nav-dropdown-links").html()},title:function(){return""},placement:"bottom-left",style:"quick-dropdown",animation:"pop"}),i(document).on("click","a.dropdown-toggle",function(){var e=i(this);return e.data("target")||e.webuiPopover({content:function(){return i(this).next(".dropdown-menu").html()},title:function(){return""},style:"buttonset",placement:"auto-top",animation:"pop"}),e.webuiPopover("show"),!1})),i("#wp-admin-bar-logout, #wp-admin-bar-user-logout, a.logout").on("click",function(){CB.DOM.logout()}),i(document).on("click","#close-notice",function(){var e;return i(this).addClass("loading"),i("#sidebar div.error").remove(),e=i(".notice").attr("rel").substr(2,i(".notice").attr("rel").length),CB.Request.updateSitewideNotice(e,i("#close-notice-nonce").val()).done(function(e){i("#close-notice").removeClass("loading"),e[0]+e[1]==="-1"?(i(".notice").prepend(e.substr(2,e.length)),i("#sidebar div.error").hide().fadeIn(200)):i(".notice").slideUp(100)}),!1}),i("body").hasClass("register")&&((t=i("#signup_with_blog")).prop("checked")||i("#blog-details").toggle(),t.change(function(){i("#blog-details").toggle()}))}),i(window).on("load",function(){CB.DOM.ItemList.updateItemListLayout("body")}),i(window).resize(function(){"equalheight"===CPSFSettings.itemListDisplayType&&CB.DOM.ItemList.updateItemListLayout("body")})}(jQuery),function(l){CB.Request={getItems:function(e,t,i,n,a,s,o){if("activity"!==e){null===t&&(t="all");var r=CB.ItemUtils;r.setObjectPreference(e,"scope",t),r.setObjectPreference(e,"filter",i),r.setObjectPreference(e,"extras",s),"friends"!==e&&"group_members"!==e||(e="members");var c={};c["bp-"+e+"-filter"]=r.getObjectPreference(e,"filter"),c["bp-"+e+"-scope"]=r.getObjectPreference(e,"scope");var d=encodeURIComponent(l.param(c));return l.post(ajaxurl,{action:e+"_filter",cookie:d,object:e,filter:i,search_terms:n,scope:t,page:a,extras:s,template:o})}},updateSitewideNotice:function(e,t){return l.post(ajaxurl,{action:"messages_close_notice",notice_id:e,nonce:t})}}}(jQuery),function(n){window.CB="undefined"==typeof CB?{}:CB;var e=CB.DOM||{};CB.DOM=n.extend(e,{logout:function(){var i="https:"===window.location.protocol;n.each(["bp-activity-scope","bp-activity-filter","bp-activity-oldestpage"],function(e,t){n.removeCookie(t,{path:"/",secure:i})});n.each(["members","groups","blogs","forums"],function(e,t){n.removeCookie("bp-"+t+"-scope",{path:"/",secure:i}),n.removeCookie("bp-"+t+"-filter",{path:"/",secure:i}),n.removeCookie("bp-"+t+"-extras",{path:"/",secure:i})}),n("body").trigger("cb:user:loggedout")}}),CB.DOM.Notices={prepareNoticeMarkup:function(e,t){var i='<div id="site-feedback-message" class="site-feedback-message '+(t=t||"info")+'">';return i+='<div class="inner">',i+='<div class="bp-template-notice '+t+'">',i+="<p>"+e+'<i class="fa fa-times-circle-o cb-close-notice" aria-hidden="true"></i></p>',i+="</div></div></div>"},append:function(e,t,i){e.length&&e.prepend(this.prepareNoticeMarkup(t,i))},prepend:function(e,t,i){e.length&&e.prepend(this.prepareNoticeMarkup(t,i))},hideAll:function(){n(".site-feedback-message").remove()},hide:function(e){e.length&&e.find(".site-feedback-message").remove()}}}(jQuery),function(o){var r={};CB.ItemUtils={getCurrentScope:function(e){return this.getObjectPreference(e,"scope")},getCurrentFilter:function(e){return this.getObjectPreference(e,"filter")},getObjectPreference:function(e,t){return r.hasOwnProperty(e)||(r[e]=this.rebuildObjectPreferences()),CPSFSettings.storeFilterSettings&&(r[e][t]=o.cookie("bp-"+e+"-"+t)),r[e][t]},setObjectPreference:function(e,t,i){var n={filter:"",scope:"",extras:""};if(!r.hasOwnProperty(e)){var a={};for(var s in n)n.hasOwnProperty(s)&&(a[s]=n[s]);r[e]=a}CPSFSettings.storeFilterSettings&&o.cookie("bp-"+e+"-"+t,i,{path:"/",secure:"https:"===window.location.protocol}),r[e][t]=i},rebuildObjectPreferences:function(){var e={filter:"",scope:"",extras:""},t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},getScopeFromElementID:function(e){if(void 0===e)return"";var t=e.split("-");return 0<t.length?t[t.length-1]:""}}}(jQuery),function(s){var e=CB.DOM.ItemList||{};CB.DOM.ItemList=s.extend(e,{updateItemListLayout:function(e){if("grid"===CPSFSettings.itemListDisplayType){var t=CPSFSettings.itemListGridType;"equalheight"===t?this.makeEqualHeightItems(e):"masonry"===t&&this.makeMasonryGrid(e)}},makeMasonryGrid:function(e){var t=s(e).find(".item-list-grid-masonry");t.imagesLoaded(function(){t.masonry({columnWidth:".item-entry-type-masonry",itemSelector:".item-entry-type-masonry"})})},makeEqualHeightItems:function(e){var a=s(e);a.imagesLoaded(function(){var t=0,i=[],n=0;a.find(".item-list-grid-equalheight>li").each(function(){var e=s(this);e.height("auto"),i.push(e),n=e.height(),t<n&&(t=n)});for(var e=0;e<i.length;e++)i[e].height(t);i=[]})}})}(jQuery),function(a){CB.DOM.ItemTabs={setState:function(e){var t=CB.ItemUtils,i=t.getCurrentScope(e),n=t.getCurrentFilter(e);void 0!==n&&a("#"+e+"-order-select select").length&&a("#"+e+'-order-select select option[value="'+n+'"]').prop("selected",!0),void 0!==i&&a("."+e+"-type-tabs").length&&(a("."+e+"-type-tabs li").removeClass("selected"),a("#"+e+"-"+i+", #object-nav li.current").addClass("selected"))},init:function(e,t,i){a(".item-list-tabs li").removeClass("selected"),a("#"+e+"-"+t+", #object-nav li.current").addClass("selected"),a(".item-list-tabs li.selected").addClass("loading"),a('.item-list-tabs select option[value="'+i+'"]').prop("selected",!0)}}}(jQuery),function(t){t(document).ready(function(){var i=CB.DOM.ItemTabs;t.each(["activity","members","groups","blogs","group_members"],function(e,t){i.setState(t)}),t(document).on("click",".dir-search-anchor",function(){var e=t(".bp-dir-search");return e.toggleClass("search-visible"),e.hasClass("search-visible")?e.slideDown(500):e.slideUp(500),!1})})}(jQuery),function(l){var u;function p(e){if(!e.length)return"";var t=e.attr("id").split("-");return t.length?t[t.length-1]:""}l(document).ready(function(){l(document).on("submit",".bp-dir-search-form",function(){var e=l(this),t=e.find(".search-input").val();t.length;var i=e.parents(".bp-search").siblings(".bp-nav"),n=i.find(".item-list-tabs"),a=i.data("object"),s=i.find(".bp-nav-filters select").val(),o=p(i.find(".item-list-tabs li.selected")),r=CB.ItemUtils.getObjectPreference(a,"extras");return n.addClass("loading"),u&&u.abort(),u=CB.Request.getItems(a,o,s,t,1,r).done(function(e){n.removeClass("loading");var t=l("div."+a);t.fadeOut(100,function(){l(this).html(e),t.trigger("updated:item:list",[a,t]),l(this).fadeIn(100)}),l(".item-list-tabs li.selected").removeClass("loading")}),!1}),l(document).on("submit","#search-members-form",function(){var e=l(this),t=e.find("#members_search").val(),i="";t.length;var n=e.parents(".bp-nav"),a=n.find(".item-list-tabs"),s=n.data("object"),o=n.find(".bp-nav-filters select").val();"members"===s&&(s="group_members",i="groups/single/members/members-loop");var r=CB.ItemUtils.getObjectPreference(s,"extras");return a.addClass("loading"),u&&u.abort(),u=CB.Request.getItems(s,"groups",o,t,1,r,i).done(function(e){a.removeClass("loading");var t=l("div."+s);t.fadeOut(100,function(){l(this).html(e),t.trigger("updated:item:list",[s,t]),l(this).fadeIn(100)}),l(".item-list-tabs li.selected").removeClass("loading")}),!1}),l(document).on("click",".item-list-tabs a",function(e){var t,i,n,a=l(this),s=a.parent("li"),o=a.parents(".bp-nav"),r=a.parents(".item-list-tabs"),c=o.data("object");if(!(a.hasClass("no-ajax")||s.hasClass("no-ajax")||r.hasClass("no-ajax"))&&(!s.parents(".activity-type-tabs").length&&"activity"!==c)){t=p(s),i=o.find(".bp-nav-filters select").val(),n=l("#"+c+"-search").val();var d=CB.ItemUtils.getObjectPreference(c,"extras");return CB.DOM.ItemTabs.init(c,t,i),"friends"!==c&&"group_members"!==c||(c="members"),u&&u.abort(),u=CB.Request.getItems(c,t,i,n,1,d).done(function(e){var t=l("div."+c);t.fadeOut(100,function(){l(this).html(e),t.trigger("updated:item:list",[c,t]),l(this).fadeIn(100)}),l(".item-list-tabs li.selected").removeClass("loading")}),!1}}),l(document).on("change",".bp-nav-filters select",function(){if(!l(this).parent().hasClass("activity-filter")){var e,t,i,n=l(this),a=n.parents(".bp-nav"),s=a.find(".item-list-tabs"),o=a.data("object"),r=n.val(),c=p(a.find(".item-list-tabs li.selected"));if(e=!1,t=null,!s.hasClass("activity-type-tabs")&&!a.hasClass("activity-type-tabs")){s.addClass("loading"),l(".bp-dir-search .search-input").length&&(e=l(".bp-dir-search .search-input").val()),(i=l(".groups-members-search input")).length&&(e=i.val(),o="members",c="groups"),"members"===o&&"groups"===c&&(o="group_members",t="groups/single/members/members-loop"),"friends"===o&&(o="members"),u&&u.abort();var d=CB.ItemUtils.getObjectPreference(o,"extras");return u=CB.Request.getItems(o,c,r,e,1,d,t).done(function(e){s.removeClass("loading");var t=l("div."+o);t.fadeOut(100,function(){l(this).html(e),t.trigger("updated:item:list",[o,t]),l(this).fadeIn(100)}),l(".item-list-tabs li.selected").removeClass("loading")}),!1}}})}),l(document).on("updated:item:list",function(e,t){CB.DOM.ItemList.updateItemListLayout("body")})}(jQuery),function(b){b(document).ready(function(){b(document).on("click",".pagination .pagination-links a",function(e){var t=b(this),i=t.parents(".pagination");if(!i.hasClass("no-ajax")){if(t.hasClass("current"))return!1;var n,a,s,o=t.parents(".item-list-container"),r=b(".bp-nav").last(),c=o.data("object"),d=!1,l=i.find(".pagination-links").attr("id"),u=null,p=i.parent("#item-body");!o.length&&p.length&&(c=p.find(".bp-search").data(".data-bp-search"),o=p.find("div."+c)),c||(c="members",o=b("#site-page").find("div."+c)),function(e){if(!e.length)return"";var t=e.attr("id").split("-");return t.length?t[t.length-1]:""}(r.find(".item-list-tabs li.selected")),b("div.dir-search input").length&&(d=!(d=b(".bp-dir-search .search-input")).val()&&bp_get_querystring(d.attr("name"))?b(".bp-dir-search .search-input").prop("placeholder"):d.val()),n=b(t).hasClass("next")||b(t).hasClass("prev")?i.find("span.current").text():b(t).text(),n=Number(n.replace(/\D/g,"")),b(t).hasClass("next")?n++:b(t).hasClass("prev")&&n--,(a=b(".groups-members-search input")).length&&(d=a.val(),c="members");var f=o.data("context");"members"===c&&"groups"===f&&(c="group_members",u="groups/single/members/members-loop"),"admin"===c&&b("body").hasClass("membership-requests")&&(c="requests"),s=-1!==l.indexOf("pag-bottom")?"pag-bottom":null;var m=CB.ItemUtils,v=m.getCurrentScope(c),h=m.getCurrentFilter(c),g=m.getObjectPreference(c,"extras");return CB.Request.getItems(c,v,h,d,n,g,u).done(function(e){if("pag-bottom"===s&&b("#subnav").length){var t=b("#subnav").parent();b("html,body").animate({scrollTop:t.offset().top},"slow",function(){o.fadeOut(100,function(){b(this).html(e),o.trigger("updated:item:list",[c,o]),b(this).fadeIn(100)})})}else o.fadeOut(100,function(){b(this).html(e),o.trigger("updated:item:list",[c,o]),b(this).fadeIn(100)});b(".item-list-tabs li.selected").removeClass("loading")}),!1}})})}(jQuery),function(i){CB.Activity=CB.Activity||{},CB.Activity.Requests={get:function(e){var t=CB.ItemUtils;return e=i.extend({scope:null,filter:null},e),t.setObjectPreference("activity","scope",e.scope),t.setObjectPreference("activity","filter",e.filter),i.post(ajaxurl,{action:"activity_filter",_wpnonce_activity_filter:i("#_wpnonce_activity_filter").val(),scope:e.scope,filter:e.filter})},getOld:function(e){var t=CB.ItemUtils;return(e=i.extend({action:"activity_get_older_updates",page:1,search_terms:"",excluded:"",scope:t.getObjectPreference("activity","scope"),filter:t.getObjectPreference("activity","filter")},e)).exclude_just_posted=i.isArray(e.excluded)?e.excluded.join(","):e.excluded,delete e.excluded,i.post(ajaxurl,e)},getSingle:function(e){return i.post(ajaxurl,{action:"activity_get_single",activity_id:e})},postUpdate:function(e){return e=e||{},e=i.extend({action:"post_update",content:"",object:"",item_id:0,since:"",_wpnonce:"",_bp_as_nonce:""},e),i.post(ajaxurl,e)},deleteActivity:function(e){return e=i.extend({action:"activity_delete",id:0,_wpnonce:""},e),i.post(ajaxurl,e)},favorite:function(e){return e=i.extend({action:"activity_mark_fav",id:0,_wpnonce:""},e),i.post(ajaxurl,e)},unfavorite:function(e){return e=i.extend({action:"activity_mark_unfav",id:0,_wpnonce:""},e),i.post(ajaxurl,e)},spam:function(e){return e=i.extend({action:"activity_mark_spam",id:0,_wpnonce:""},e),i.post(ajaxurl,e)},postComment:function(e){return e=e||{},(e=i.extend({action:"activity_post_comment",comment_id:0,activity_id:0,content:"",_wpnonce:"",nonce2:""},e))["_bp_as_nonce_"+e.comment_id]=e.nonce2,delete e.nonce2,i.post(ajaxurl,e)},deleteComment:function(e){return e=i.extend({action:"activity_delete_comment",id:0,_wpnonce:""},e),i.post(ajaxurl,e)},spamComment:function(e){return e=i.extend({action:"activity_mark_comment_spam",id:0,_wpnonce:""},e),i.post(ajaxurl,e)}}}(jQuery),function(s){var t={initActivityFilter:function(e,t){s(".item-list-tabs li").removeClass("selected loading"),s("#activity-"+e+", .item-list-tabs li.current").addClass("selected"),s("#object-nav.item-list-tabs li.selected, div.activity-type-tabs li.selected").addClass("loading"),s('#activity-filter-select select option[value="'+t+'"]').prop("selected",!0),s(".widget_bp_activity_widget h2 span.ajax-loader").show()},updateFilteredActivities:function(e){s(".widget_bp_activity_widget h2 span.ajax-loader").hide(),s("div.activity").fadeOut(100,function(){s(this).html(e.data.contents),s(this).fadeIn(100),t.hideComments()}),void 0!==e.data.feed_url&&s(".directory #subnav li.feed a, .home-page #subnav li.feed a").attr("href",e.data.feed_url),s(".item-list-tabs li.selected").removeClass("loading")},hideComments:function(){var t,i,e,n,a=s("div.activity-comments");if(!a.length)return!1;a.each(function(){s(this).children("ul").children("li").length<5||(e=s(this),t=e.parents("#activity-stream > li"),i=s(this).children("ul").children("li"),n=0,s("#"+t.attr("id")+" li").length&&(n=s("#"+t.attr("id")+" li").length),i.each(function(e){e<i.length-5&&(s(this).hide(),e||s(this).before('<li class="show-all-comments"><a href="#'+t.attr("id")+'/show-all/">'+CPSFSettings.showXComments.replace("%d",n)+"</a></li>"))}))})}};CB.Activity.DOM=t}(jQuery),function(f,m){var o,r="",c=1,d=0;f.Activity.PostFilter=m.Callbacks(),f.Activity.CommentFilter=m.Callbacks(),m(document).ready(function(){var p=f.Activity.Requests,s=f.Activity.DOM;m(document).on("loaded:activity:post:form",function(e,t){var i,n=t.find(".bp-activity-post-editor"),a=t.find(".bp-activity-post-in-options");t.find(".bp-activity-post-form-actions").hide(),n.length&&bp_get_querystring("r")?(i=(i=n.html()).replace(/<br>|<div>/gi,"").replace(/<\/div>/gi,""),a.slideDown(),m.scrollTo(t,500,{offset:-125,easing:"swing"}),n.each(function(){m(this).hasClass("emojionearea")||m(this).focus().html(i)})):a.hide()}),m(document).on("focus:activity:post:content.showPostOptions",function(e,t,i){i.find(".bp-activity-post-in-options").show(),i.find(".bp-activity-post-form-actions").slideDown()}),m(document).on("focus:activity:post:content.updateFormState",function(e,t,i){i.length&&(i.find(".bp-activity-post-editor-container").addClass("active"),i.addClass("active"),i.hasClass("submitted")&&i.removeClass("submitted"))}),m(document).on("focus:activity:post:content.resetFilters",function(e,t,i){var n=m("#activity-all"),a=m("#activity-filter-select select");n.length&&(n.hasClass("selected")?"-1"!==a.val()&&(a.val("-1"),a.trigger("change")):(a.val("-1"),n.find("a").trigger("click")))}),m(document).on("focusout:activity:post:content.updateFormState",function(e,t,i){i.length&&(i.find(".bp-activity-post-editor-container").removeClass("active"),i.removeClass("active"))}),m(document).on("click:activity:post:cancel",function(e,t,i){i.find(".bp-activity-post-in-options").hide(),i.find(".bp-activity-post-form-actions").slideUp()}),m(document).on("click:activity:publish",function(e,t,i){var n,a,s,o,r,c,d=0,l="",u=null;i.trigger("before:publish:activity:request",[i]),a=i.find(".bp-activity-post-object-id").val(),(s=i.find(".bp-activity-post-editor").first()).find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),o=(o=s.html()).replace(/<br>|<div>/gi,"\n").replace(/<\/div>/gi,""),(c=r=m(".activity-list li").first()).length&&(c.hasClass("load-newest")&&(c=r.next()),u=c.prop("class").match(/date-recorded-([0-9]+)/)),u&&(d=u[1]),0<a&&(l=i.find(".bp-activity-post-object").val()),n=m.extend({content:o,object:l,item_id:a,since:d,_wpnonce:m("#_wpnonce_post_update").val(),_bp_as_nonce:m("#_bp_as_nonce").val()||""},{}),f.Activity.PostFilter.fire(n),p.postUpdate(n).done(function(e){i.find("textarea,input").each(function(){m(this).prop("disabled",!1)}),e.success?i.trigger("published:activity",[e.data,i]):(i.removeClass("submitted loading"),f.DOM.Notices.prepend(i,e.data.message,"error"),i.find(".error").hide().fadeIn(200),i.trigger("error:publish:activity",[e.data,i]))})}),m(document).on("before:publish:activity:request.updateFormState",function(e,t){t.find("textarea,input").each(function(){m(this).prop("disabled",!0)}),m("div.error").remove(),t.find(".bp-activity-post-submit").prop("disabled",!0),t.addClass("submitted").find(".bp-activity-post-form-actions").addClass("loading")}),m(document).on("published:activity.updateFormState",function(e,t,i){var n=i.find(".bp-activity-post-editor-container");i.find(".bp-activity-post-submit").prop("disabled",!1).removeClass("loading"),i.removeClass("submitted").find(".bp-activity-post-form-actions").removeClass("loading"),n.removeClass("active")}),m(document).on("error:publish:activity.updateFormState",function(e,t,i){i.find(".bp-activity-post-editor-container");i.find(".bp-activity-post-submit").prop("disabled",!1).removeClass("loading"),i.removeClass("submitted").find(".bp-activity-post-form-actions").removeClass("loading")}),m(document).on("published:activity.appendToList",function(e,t,i){var n;m(".activity-list").length||(m(".error").slideUp(100).remove(),m("#message").slideUp(100).remove(),m("div.activity").append('<ul id="activity-stream" class="activity-list item-list">')),(n=m(".activity-list li").first()).hasClass("load-newest")&&n.remove(),m("#activity-stream").prepend(t.contents),m(".activity-list li:first").addClass("new-update just-posted"),m("li.new-update").hide().slideDown(300).removeClass("new-update"),i.find(".bp-activity-post-editor").each(function(){m(this).hasClass("emojionearea")||m(this).html("")}),r="",d=0}),m(document).on("click:activity:tab",function(e,t,i,n){return s.initActivityFilter(i,n),p.get({scope:i,filter:n}).done(function(e){s.updateFilteredActivities(e)}),!1}),m(document).on("change:activity:filter",function(e,t,i,n){s.initActivityFilter(i,n),o&&o.abort(),o=p.get({scope:i,filter:n}).done(function(e){s.updateFilteredActivities(e)})}),m(document).on("click:activity:favorite",function(e,i,n,t,a){if(i.hasClass("loading"))return!1;i.addClass("loading"),p.favorite({id:t,_wpnonce:a}).done(function(e){var t=m("item-list-tabs ul #activity-favorites");i.removeClass("loading"),e.success?(i.fadeOut(200,function(){m(this).html(e.data.label),m(this).attr("title",e.data.title),m(this).fadeIn(200)}),t.length&&t.find("span").html(Number(t.find("span").html())+1),i.removeClass("fav"),i.addClass("unfav")):n.prepend(e.message)})}),m(document).on("click:activity:unfavorite",function(e,i,n,t,a){return i.hasClass("loading")||(i.addClass("loading"),p.unfavorite({id:t,_wpnonce:a}).done(function(e){var t=m(".item-list-tabs ul #activity-favorites");i.removeClass("loading"),e.success?(i.fadeOut(200,function(){m(this).html(e.data.label),m(this).attr("title",e.data.title),m(this).fadeIn(200)}),i.removeClass("unfav"),i.addClass("fav"),t.length&&t.find("span").html(Number(t.find("span").html())-1),Number(t.find("span").html())||(t.hasClass("selected")&&p.get({scope:null,filter:null}).done(function(e){s.updateFilteredActivities(e)}),t.remove()),"activity-favorites"===m(".item-list-tabs li.selected").attr("id")&&n.slideUp(100)):n.prepend(e.message)})),!1}),m(document).on("click:activity:delete",function(e,t,i,n,a,s){if(t.hasClass("loading"))return!1;t.addClass("loading"),p.deleteActivity({id:n,_wpnonce:s}).done(function(e){e.success?(i.slideUp(300),a&&d===a[1]&&(r="",d=0)):(f.DOM.Notices.prepend(i,e.data.message,"error"),i.find(".error").hide().fadeIn(300))})}),m(document).on("click:activity:spam",function(e,t,i,n,a,s){return t.hasClass("loading")||(t.addClass("loading"),p.spam({id:n,_wpnonce:s}).done(function(e){if(!e.success)return f.DOM.Notices.prepend(i,e.data.message,"error"),void i.find(".error").hide().fadeIn(300);i.slideUp(300),a&&d===a[1]&&(r="",d=0)})),!1}),m(document).on("click:activity:readmore",function(e,t,i,n){var a;return a=m("#"+n+"-"+i+" ."+("acomment"===n?"acomment-inner":"activity-inner")+":first"),m(t).addClass("loading"),p.getSingle(i).done(function(e){e.success?a.slideUp(300).html(e.data.contents).slideDown(300):e.data.redirect&&(window.location.href=e.data.redirect)}),!1}),m(document).on("click:activity:loadmore",function(e,t){var i,n,a;return o&&o.abort(),t.parent("li").addClass("loading"),n=[],m(".activity-list li.just-posted").each(function(){n.push(m(this).attr("id").replace("activity-",""))}),i=bp_get_querystring("s"),a=c+1,o=p.getOld({page:a,search_terms:i,excluded:n}).done(function(e){t.parent("li").removeClass("loading"),c=a,t.parents(".activity-list").append(e.data.contents),t.parent().hide()}),!1}),m(document).on("click:activity:loadnew",function(e,t){var i;return e.preventDefault(),t.parent().hide(),i=m.parseHTML(r),m.each(i,function(e,t){"LI"===t.nodeName&&m(t).hasClass("just-posted")&&m("#"+m(t).attr("id")).length&&m("#"+m(t).attr("id")).remove()}),t.parents(".activity-list").prepend(r),r="",!1}),m(document).keydown(function(e){var t;(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0!==e.ctrlKey&&!0!==e.altKey&&!0!==e.metaKey&&27===(e.keyCode?e.keyCode:e.which)&&"TEXTAREA"===t.tagName&&m(t).hasClass("ac-input")&&m(t).parent().parent().parent().slideUp(200)}),"undefined"!=typeof wp&&void 0!==wp.heartbeat&&void 0!==CPSFSettings.pulse&&(wp.heartbeat.interval(Number(CPSFSettings.pulse)),m.fn.extend({"heartbeat-send":function(){return this.bind("heartbeat-send.buddypress")}}));var i=0,n="",a=null;m(document).on("heartbeat-send.buddypress",function(e,t){i=0,m(".activity-list li").first().prop("id")&&(a=m(".activity-list li").first().prop("class").match(/date-recorded-([0-9]+)/))&&(i=a[1]),(0===d||Number(i)>d)&&(d=Number(i)),t.bp_activity_last_recorded=d,(n=bp_get_querystring("s"))&&(t.bp_activity_last_recorded_search_terms=n)}),m(document).on("heartbeat-tick.cb",function(e,t){t.bp_activity_newest_activities&&(r=t.bp_activity_newest_activities.activities+r,d=Number(t.bp_activity_newest_activities.last_recorded),m(document).trigger("heartbeat:activity:new",[r,d]))}),m(document).on("heartbeat:activity:new",function(e,t,i){m(".activity-list li").first().hasClass("load-newest")||m(".activity-list").prepend('<li class="load-newest"><a href="#newest">'+CPSFSettings.newest+"</a></li>")})})}(CB||{},jQuery),function(s){function o(e){return e.data("id")?e.data("id"):e.attr("id").substr(9,e.attr("id").length)}s(document).ready(function(){var e=s(".bp-activity-post-form");e.length&&e.trigger("loaded:activity:post:form",[e]),s(document).on("click",".activity-type-tabs a",function(e){var t,i,n=s(this).parent();if(!n.parents(".item-list-tabs").hasClass("no-ajax"))return t=n.attr("id").substr(9,n.attr("id").length),i=s("#activity-filter-select select").val(),"mentions"===t&&n.find("a strong").remove(),s(this).trigger("click:activity:tab",[n,t,i]),!1}),s(document).on("change","#activity-filter-select select",function(){var e,t=s(".activity-type-tabs li.selected"),i=s(this).val();return e=t.length?t.attr("id").substr(9,t.attr("id").length):null,s(this).trigger("change:activity:filter",[t,e,i]),!1}),s(document).on("focus",".bp-activity-post-editor",function(){var e=s(this),t=e.closest(".bp-activity-post-form");e.trigger("focus:activity:post:content",[e,t])}),s(document).on("focusout",".bp-activity-post-editor",function(e){var t=s(this),i=t.closest(".bp-activity-post-form");setTimeout(function(){if(!i.find(":hover").length){if(t.html().length)return;t.trigger("focusout:activity:post:content",[t,i])}},0)}),s(document).on("click",".bp-activity-post-submit",function(){var e=s(this),t=e.closest(".bp-activity-post-form");return e.trigger("click:activity:publish",[e,t]),!1}),s(document).on("click",".bp-activity-post-cancel",function(){var e=s(this),t=e.closest(".bp-activity-post-form");return e.trigger("click:activity:post:cancel",[e,t]),!1}),s(document).on("click",".activity-item .fav, .activity-item .unfav",function(){var e,t,i,n,a=s(this);return a.hasClass("loading")||(n=a.hasClass("fav"),t=o(e=a.closest(".activity-item")),i=bp_get_query_var("_wpnonce",a.attr("href")),n?a.trigger("click:activity:favorite",[a,e,t,i]):a.trigger("click:activity:unfavorite",[a,e,t,i])),!1}),s(document).on("click",".delete-activity, .spam-activity",function(){var e,t,i,n,a=s(this);return t=o(e=a.closest(".activity-item")),i=bp_get_query_var("_wpnonce",a.attr("href")),n=e.prop("class").match(/date-recorded-([0-9]+)/),a.hasClass("delete-activity")?a.trigger("click:activity:delete",[a,e,t,n,i]):a.hasClass("spam-activity")&&a.trigger("click:activity:spam",[a,e,t,n,i]),!1}),s(document).on("click",".activity-read-more a",function(e){var t=s(this),i=t.parent().attr("id").split("-"),n=i[3],a=i[0];return t.trigger("click:activity:readmore",[t,n,a]),!1}),s(document).on("click",".load-more a",function(){var e=s(this);return e.trigger("click:activity:loadmore",[e]),!1}),s(document).on("click",".load-newest a",function(e){var t=s(this);return e.preventDefault(),t.parent().hide(),t.trigger("click:activity:loadnew",[t]),!1})})}(jQuery),function(c){c(document).ready(function(){c(document).on("click",".acomment-reply",function(){var e,t,i,n=c(this),a=n.attr("id").split("-");return e=a[2],t=n.attr("href").substr(10,n.attr("href").length),i="comment"===a[1]?"comment":"reply",c(this).trigger("click:activity:reply",[n,e,t,i]),!1}),c(document).on("focus",".ac-input",function(){var e=c(this),t=e.closest(".ac-form");e.trigger("focus:activity:comment:content",[e,t])}),c(document).on("focusout",".ac-input",function(e){var t=c(this),i=t.closest(".ac-form");setTimeout(function(){i.find(":hover").length||(t.html().length,t.trigger("focusout:activity:comment:content",[t,i]))},0)}),c(document).on("click",".ac-reply-cancel",function(){var e=c(this);return e.trigger("click:activity:comment:reply:cancel",[e]),!1}),c(document).on("click",".ac-form-submit",function(){var e,t,i,n,a,s,o,r=c(this);return t=(e=r.parents("form")).parent(),o=(i=e.attr("id").split("-"))[2],n=t.hasClass("activity-comments")?i[2]:t.attr("id").split("-")[1],(a=c("#"+e.attr("id")+" .ac-input").first()).find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),s=a.html().replace(/<br>|<div>/gi,"\n").replace(/<\/div>/gi,""),a.html(""),r.trigger("click:activity:comment:submit",[r,e,o,n,s,c("#_wpnonce_new_activity_comment").val(),void 0]),!1}),c(document).on("click",".acomment-delete,.spam-activity-comment",function(){var e=c(this),t=e.attr("href"),i=e.closest(".acomment-item"),n=bp_get_query_var("_wpnonce",t),a=bp_get_query_var("cid",t);return e.hasClass("acomment-delete")?e.trigger("click:activity:comment:delete",[e,i,a,n]):e.hasClass(".spam-activity-comment")&&c(this).trigger("click:activity:comment:spam",[e,i,a,n]),!1}),c(document).on("click",".show-all-comments a",function(){var e=c(this);return c(this).trigger("click:activity:comment:showall",[e]),!1})})}(jQuery),function(l){l(document).ready(function(){var d=CB.Activity.Requests,e=CB.Activity.DOM;l("form.ac-form").hide(),e.hideComments(),l(document).on("click:activity:comment:showall",function(e,t){t.parent().addClass("loading"),setTimeout(function(){t.parent().parent().children("li").fadeIn(200,function(){t.parent().remove()})},600)}),l(document).on("click:activity:reply",function(e,t,i,n,a){var s=l("#ac-form-"+i);return s.css("display","none"),s.removeClass("root"),l(".ac-form").hide(),s.find(".error").hide(),"comment"!==a?l("#acomment-"+n).append(s):l("#activity-"+i+" .activity-comments").append(s),s.parent().hasClass("activity-comments")&&s.addClass("root"),s.slideDown(200),l.scrollTo(s,500,{offset:-100,easing:"swing"}),s.find(".ac-input").focus(),s.trigger("activity:reply:form:visible",[s,i]),!1}),l(document).on("click:activity:comment:reply:cancel",function(e,t){return t.closest(".ac-form").slideUp(200),!1}),l(document).on("click:activity:comment:submit",function(e,o,r,c,t,i,n,a){var s={activity_id:c,comment_id:t,content:i,_wpnonce:n,nonce2:a};return r.find(".error").hide(),o.addClass("loading").prop("disabled",!0),r.addClass("loading"),CB.Activity.CommentFilter.fire(s),d.postComment(s).done(function(e){var t,i,n,a,s;if(o.removeClass("loading"),r.removeClass("loading"),!e.success)return CB.DOM.Notices.append(r,e.data.message,"error"),void r.find(".site-feedback-message").hide().fadeIn(200);t=r.parent(),r.fadeOut(200,function(){0===t.children("ul").length&&(t.hasClass("activity-comments")?t.prepend("<ul></ul>"):t.append("<ul></ul>")),i=l.trim(e.data.content),t.children("ul").append(l(i).hide().fadeIn(200)),r.find(".ac-input").val(""),t.parent().addClass("has-comments")}),r.find("textarea").val(""),n=l("#activity-"+c),a=Number(n.find(".acomment-reply span").html())+1,n.find(".acomment-reply span").html(a),(s=t.parents(".activity-comments").find(".show-all-comments a"))&&s.html(CPSFSettings.showXComments.replace("%d",a)),o.prop("disabled",!1)}),!1}),l(document).on("click:activity:comment:delete",function(e,t,o,i,n){var a,r;if(!t.hasClass("loading"))return a=o.parents(".activity-comments").children("form"),r=o.closest(".activity-item"),t.addClass("loading"),r.find(".activity-comments ul .error").remove(),o.parents(".activity-comments").append(a),d.deleteComment({id:i,_wpnonce:n}).done(function(e){var t,i,n,a,s;if(!e.success)return CB.DOM.Notices.prepend(o,e.data.message,"error"),void o.find(".error").hide().fadeIn(200);t=l("#acomment-"+e.data.id+" ul").children("li"),i=0,l(t).each(function(){l(this).is(":hidden")||i++}),o.fadeOut(200,function(){o.remove()}),a=(n=r.find(".acomment-reply span")).html()-(1+i),n.html(a),(s=o.parents(".activity-comments").find(".show-all-comments a"))&&s.html(CPSFSettings.showXComments.replace("%d",a)),0==a&&r.removeClass("has-comments")}),!1}),l(document).on("click:activity:comment:spam",function(e,t,n,i,a){var s;t.hasClass("loading")||(t.addClass("loading"),(s=n.closest(".activity-item")).find(".error").remove(),n.parents(".activity-comments").append(n.parents(".activity-comments").children("form")),d.spamComment({id:i,_wpnonce:a}).done(function(e){var t,i;if(!e.success)return CB.DOM.Notices.prepend(n,e.data.message,"error"),void n.find(".error").hide().fadeIn(200);t=l("#"+n.attr("id")+" ul").children("li"),i=0,l(t).each(function(){l(this).is(":hidden")||i++}),n.fadeOut(200),l("#"+s.attr("id")+" .acomment-reply span").html(l("#"+s.attr("id")+" a.acomment-reply span").html()-(1+i))}))})})}(jQuery),function(e,t){e.Friends=e.Friends||{},e.Friends.Requests={requestFriendship:function(e){return e=t.extend({action:"friends_request_friendship",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},cancelRequest:function(e){return e=t.extend({action:"friends_cancel_friendship_request",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},cancelFriendship:function(e){return e=t.extend({action:"friends_cancel_friendship",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},acceptFriendship:function(e){return e=t.extend({action:"friends_accept_friendship",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},rejectRequest:function(e){return e=t.extend({action:"friends_reject_friendship",id:0,_wpnonce:""},e),t.post(ajaxurl,e)}}}(CB||{},jQuery),function(a){a(document).on("click",".friendship-button a",function(){var e=a(this),t=e.attr("id"),i=bp_get_query_var("_wpnonce",e.attr("href")),n=e.parent(".generic-button");return t=(t=t.split("-"))[t.length-1],e.hasClass("not_friends")?e.trigger("click:request:friendship",[e,n,t,i]):e.hasClass("pending_friend")?e.trigger("click:cancel:friendship:request",[e,n,t,i]):e.hasClass("is_friend")?e.trigger("click:cancel:friendship",[e,n,t,i]):e.hasClass("accept_friendship")?e.trigger("click:accept:friendship",[e,n,t,i]):e.hasClass("reject_friendship")&&e.trigger("click:reject:friendship",[e,n,t,i]),!1})}(jQuery),function(e){var s=CB.Friends.Requests;function o(e,t){t.removeClass("loading"),e.success?t.fadeOut(100,function(){t.trigger("webui:refresh"),t.replaceWith(e.data.button)}):t.parents(".list-item").append(e.data.message)}function r(e,t){t.removeClass("loading"),e.success?t.fadeOut(100,function(){t.trigger("webui:refresh"),t.replaceWith(e.data.message)}):t.parents(".list-item").append(e.data.message)}e(document).on("click:request:friendship",function(e,t,i,n,a){i.addClass("loading"),s.requestFriendship({id:n,_wpnonce:a}).then(function(e){o(e,i)})}),e(document).on("click:cancel:friendship:request",function(e,t,i,n,a){i.addClass("loading"),s.cancelRequest({id:n,_wpnonce:a}).then(function(e){o(e,i)})}),e(document).on("click:cancel:friendship",function(e,t,i,n,a){i.addClass("loading"),s.cancelFriendship({id:n,_wpnonce:a}).then(function(e){o(e,i)})}),e(document).on("click:accept:friendship",function(e,t,i,n,a){i.addClass("loading"),i.siblings(".reject_friendship").hide(),s.acceptFriendship({id:n,_wpnonce:a}).then(function(e){r(e,i)})}),e(document).on("click:reject:friendship",function(e,t,i,n,a){i.addClass("loading"),i.siblings(".accept_friendship").hide(),s.rejectRequest({id:n,_wpnonce:a}).then(function(e){r(e,i)})})}(jQuery),function(s){s(document).ready(function(){s(document).on("click",".visibility-toggle-link, .current-visibility-level",function(e){e.preventDefault();var t=s(this),i=t.parents(".editfield"),n=i.find(".field-visibility-settings-toggle"),a=i.find(".field-visibility-settings");n.hasClass("field-visibility-settings-notoggle").length||(t.attr("aria-expanded","true"),n.hide(500).addClass("field-visibility-settings-hide"),a.slideDown(500).addClass("field-visibility-settings-open"))}),s(document).on("click",".field-visibility-settings-close",function(e){var t=s(this).parents(".editfield"),i=t.find(".field-visibility-settings-toggle"),n=t.find(".field-visibility-settings"),a=n.find("input:checked").parent().text();i.find(".visibility-toggle-link, .current-visibility-level").attr("aria-expanded","false"),e.preventDefault(),n.slideUp(500).removeClass("field-visibility-settings-open"),i.find(".current-visibility-level").text(a).end().show(500).removeClass("field-visibility-settings-hide")}),s(document).on("click",".field-visibility-settings .radio input",function(){var e=s(this).parents(".editfield"),t=e.find(".field-visibility-settings-toggle"),i=e.find(".field-visibility-settings"),n=i.find("input:checked").parent().text();t.find(".visibility-toggle-link, .current-visibility-level").attr("aria-expanded","false"),i.slideUp(500).removeClass("field-visibility-settings-open"),t.find(".current-visibility-level").text(n).end().show(500).removeClass("field-visibility-settings-hide")}),s("#profile-edit-form input:not(:submit), #profile-edit-form textarea, #profile-edit-form select, #signup_form input:not(:submit), #signup_form textarea, #signup_form select").change(function(){var t=!0;s("#profile-edit-form input:submit, #signup_form input:submit").on("click",function(){t=!1}),window.onbeforeunload=function(e){if(t)return CPSFSettings.unsaved_changes}})})}(jQuery),function(t){window.CB="undefined"==typeof CB?{}:CB,CB.Notifications={},CB.Notifications.Requests={get:function(e){return e=t.extend({action:"cb_notifications_get",scope:"all",page:0,offset:0,max:0,_wpnonce:""},e),t.post(ajaxurl,e)},getSingle:function(e){return e=t.extend({action:"cb_notifications_get_single",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},deleteOne:function(e){return e=t.extend({action:"cb_notifications_delete",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},deleteAll:function(e){return e=t.extend({action:"cb_notifications_delete_bulk",ids:[],_wpnonce:""},e),t.post(ajaxurl,e)},markRead:function(e){return e=t.extend({action:"cb_notifications_mark_read",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},markUnread:function(e){return e=t.extend({action:"cb_notifications_mark_unread",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},markAllRead:function(e){return e=t.extend({action:"cb_notifications_mark_read_bulk",ids:[],_wpnonce:""},e),t.post(ajaxurl,e)},markAllUnread:function(e){return e=t.extend({action:"cb_notifications_mark_unread_bulk",ids:[],_wpnonce:""},e),t.post(ajaxurl,e)}}}(jQuery),function(r){var c=CB.Notifications.Requests;function n(e){var t=e.find(".bulk-toolbar-options");0<e.find(".notification-check:checked").length?t.removeClass("toolbar-hidden").addClass("toolbar-visible"):t.removeClass("toolbar-visible").addClass("toolbar-hidden")}function d(e,t){e.find("#notification-entry-"+t).slideUp(500,function(){r(this).remove()})}function l(t,e,i,n){return c.get({page:1,next:e,id:t.data("min-id"),scope:i,_wpnonce:n}).then(function(e){if(e.success)return t.find(".notifications-list").append(e.data.contents),u(t),o(t,e),e})}function o(e,t){t.data.has_more||e.find(".load-more-wrapper").slideUp(500)}function u(e){var t=0;e.find(".notifications-list .notification-entry").each(function(){var e=r(this).data("id");e<(t=t||e)&&(t=e)}),e.data("min-id",t)}function p(e){return e.find(".notification-check:checked").map(function(){return r(this).val()}).get()}r(document).ready(function(){var e,t,s,i;r(document).on("click","#select-all-notifications",function(){n(r(this).closest(".notifications-container"))}),r(document).on("click",".notifications-container .notification-check",function(){n(r(this).closest(".notifications-container"))}),r("#select-all-notifications").click(function(e){this.checked?r(".notification-check").each(function(){this.checked=!0}):r(".notification-check").each(function(){this.checked=!1})}),t=(e=r("#subnav").find(".current")).length?e.attr("id").split("-"):[],"my"===(s=t.length?"notifications"===t[0]?t[1]:t[0]:"all")&&(s="unread"),(i=r(".notifications-container")).find(".notification-entry").length&&i.find(".visible-on-load").removeClass("visible-on-load"),u(i),r(document).on("click",".notification-actions-toolbar a",function(){var e=r(this),t=e.closest(".notifications-container"),i=t.data("nonce");return e.hasClass("reload")?e.trigger("click:notifications:reload",[e,t,s,i]):e.hasClass("bulk-delete")?e.trigger("click:notifications:delete:bulk",[e,t,s,i]):e.hasClass("mark-read")?e.trigger("click:notifications:mark:read:bulk",[e,t,s,i]):e.hasClass("mark-unread")&&e.trigger("click:notifications:mark:unread:bulk",[e,t,s,i]),!1}),r(document).on("click",".notification-actions a",function(){var e=r(this),t=e.closest(".notification-entry"),i=e.closest(".notifications-container"),n=i.data("nonce"),a=t.data("id");return e.hasClass("delete")?e.trigger("click:notification:delete",[e,t,i,a,s,n]):e.hasClass("mark-read")?e.trigger("click:notification:mark:read",[e,t,i,a,s,n]):e.hasClass("mark-unread")&&e.trigger("click:notification:mark:unread",[e,t,i,a,s,n]),!1}),r(document).on("click",".notifications-container .load-more",function(){var e=r(this),t=e.closest(".notifications-container"),i=t.data("nonce");return e.trigger("click:notifications:load:more",[e,t,s,i]),!1})}),r(document).on("click:notifications:load:more",function(e,t,i,n,a){t.addClass("loading"),l(i,20,n,a).then(function(){t.removeClass("loading")})}),r(document).on("click:notifications:reload",function(e,t,i,n,a){var s=i.find(".notification-actions-toolbar");s.addClass("loading"),c.get({page:1,scope:n,_wpnonce:a}).then(function(e){var t;s.removeClass("loading"),e.success?(t=i.find(".notifications-list")).fadeOut(500,function(){t.html(e.data.contents),t.fadeIn(500),u(i),o(i,e)}):i.prepend(e.data.message)})}),r(document).on("click:notifications:delete:bulk",function(e,t,i,n,a){var s=i.find(".notification-actions-toolbar");s.addClass("loading"),c.deleteAll({ids:p(i),_wpnonce:a}).then(function(e){s.removeClass("loading"),e.success?(r.each(e.data.ids,function(e,t){d(i,t)}),l(i,e.data.ids.length,n,a)):i.prepend(e.data.message)})}),r(document).on("click:notifications:mark:read:bulk",function(e,t,n,a,s){var o=n.find(".notification-actions-toolbar");o.addClass("loading"),c.markAllRead({ids:p(n),_wpnonce:s}).then(function(e){var i;o.removeClass("loading"),e.success?(i="unread"===a,r.each(e.data.ids,function(e,t){n.find("#notification-entry-"+t).removeClass("unread-notification").addClass("read-notification"),i&&d(n,t)}),i&&l(n,e.data.ids.length,a,s)):n.prepend(e.data.message)})}),r(document).on("click:notifications:mark:unread:bulk",function(e,t,n,a,s){var o=n.find(".notification-actions-toolbar");o.addClass("loading"),c.markAllUnread({ids:p(n),_wpnonce:s}).then(function(e){var i;o.removeClass("loading"),e.success?(i="read"===a,r.each(e.data.ids,function(e,t){n.find("#notification-entry-"+t).removeClass("read-notification").addClass("unread-notification"),i&&d(n,t)}),i&&l(n,e.data.ids.length,a,s)):n.prepend(e.data.message)})}),r(document).on("click:notification:mark:read",function(e,t,i,n,a,s,o){t.addClass("loading"),c.markRead({id:a,_wpnonce:o}).then(function(e){t.removeClass("loading"),e.success?(i.removeClass("unread-notification").addClass("read-notification"),"unread"===s&&(d(n,a),l(n,1,s,o))):i.append(e.data.message)})}),r(document).on("click:notification:mark:unread",function(e,t,i,n,a,s,o){t.addClass("loading"),c.markUnread({id:a,_wpnonce:o}).then(function(e){t.removeClass("loading"),e.success?(i.removeClass("read-notification").addClass("unread-notification"),"read"===s&&(d(n,a),l(n,1,s,o))):i.append(e.data.message)})}),r(document).on("click:notification:delete",function(e,t,i,n,a,s,o){t.addClass("loading"),c.deleteOne({id:a,_wpnonce:o}).then(function(e){t.removeClass("loading"),e.success?(d(n,a),l(n,1,s,o)):i.append(e.data.message)})})}(jQuery),function(t){window.CB=window.CB||{},CB.Messages=CB.Messages||{},CB.Messages.Requests={loadThreads:function(e){return e=t.extend({action:"cb_messages_get_threads",page:0,search_terms:"",type:"all",_wpnonce:""},e),t.post(ajaxurl,e)},loadThread:function(e){return e=t.extend({action:"cb_messages_get_thread",id:0,_wpnonce:""},e),t.post(ajaxurl,e)},postReply:function(e){return e=t.extend({action:"cb_messages_add_reply",thread_id:0,content:"",_wpnonce:""},e),t.post(ajaxurl,e)},postNewMessage:function(e){return e=t.extend({action:"cb_messages_new_message",send_to:[],content:"",_wpnonce:""},e),t.post(ajaxurl,e)},deleteThread:function(e){return e=t.extend({action:"cb_messages_delete_thread",id:0,_wpnonce:""},e),t.post(ajaxurl,e)}}}(jQuery),function(e,p){var f=e.Messages.Requests,m=p.cbDebounce,v=null,h=CommunityBuilderBP.isCompose;p(document).ready(function(){var e=p("#bp-messages-view-container"),t=p("#bp-messages-view-visible"),o=p("#bp-messages-toolbar"),r=p("#bp-messages-list"),c=p("#bp-threads-panel"),d=p("#bp-messages-panel"),n=p(".bp-message-write-panel"),a=c.data("nonce"),i=0,s="";t.removeClass("hidden");bp_get_query_var("r",window.location.href);function l(){parseInt(r.data("thread-id"),10)?(i=r.data("thread-id"),s=r.data("nonce")):i=p("#bp-thread-list").find(".message-thread-entry").first().data("thread-id"),parseInt(i,10)<=0||void 0===i?p(".message-compose").trigger("click"):u(i,s).then(function(e){if(!e.success)return e;var t=p("#bp-thread-list").find("#m-"+i);t.length?t.trigger("bp:message:loaded:first",[t,r,o,e.data]):r.trigger("bp:message:loaded:first",[t,r,o,e.data])})}function u(e,t){p(".bp-message-send-to-holder").remove();var i=p("#bp-thread-list").find("#m-"+e);return p(".message-thread-entry").removeClass("current-thread"),i.length?(t=i.data("nonce"),i.addClass("current-thread loading"),o.addClass("loading"),f.loadThread({id:e,_wpnonce:t}).done(function(e){return o.removeClass("loading"),i.removeClass("loading"),e.success&&(r.data("thread-id",e.data.thread_id),n.data("thread-id",e.data.thread_id),r.html(e.data.messages),o.html(e.data.info)),e})):(o.hide(),p.Deferred().reject({}))}e.length&&(p(document).on("click",".message-thread-entry",function(){var t=p(this);if(t.length)return u(t.data("thread-id"),t.data("nonce")).done(function(e){t.trigger("bp:message:loaded",[t,r,o,e.data])}),!1}),p(document).on("click",".bp-thread-list .load-more-messages",function(){var t=p(this);if(!t.hasClass("loading"))return v&&v.abort(),t.addClass("loading"),t.find("a").text(t.data("text-loading")),v=f.loadThreads({page:parseInt(t.data("page"),10)+1,_wpnonce:a}).done(function(e){t.removeClass("loading"),t.find("a").text(t.data("text-load-more")),e.success&&(t.hide(),t.after(e.data.threads))}),!1}),p("#search-message-form").on("submit",function(){return!1}),p(document).on("input","#messages_search",m(function(){v&&v.abort();var e=p(this),i=e.closest("form");return i.addClass("loading"),v=f.loadThreads({page:1,_wpnonce:a,search_terms:e.val()}).done(function(e){if(i.removeClass("loading"),e.success){var t=p("#bp-thread-list");t.fadeOut(500,function(){t.html(e.data.threads),t.fadeIn()})}}),!1},150)),p(document).on("click",".message-compose",function(){if(p(".bp-message-send-to-holder").length)return!1;r.data("thread-id",0),n.data("thread-id",0),r.html(""),o.html("");var e=p("#bp-messages-contents");return e.prepend(p("#bp-message-send-to-template").html()),e.find(".send-to-input").bp_mentions({data:[],suffix:" "}),!1}),h?p(".message-compose").trigger("click"):l(),p(document).on("click",".bp-message-reload",function(){var e=p(this);e.data("thread-id"),e.data("nonce");return!1}),p(document).on("click",".message-delete-button",function(){var t=p(this),i=t.data("thread-id"),e=bp_get_query_var("_wpnonce",t.attr("href"));return f.deleteThread({_wpnonce:e,id:i}).done(function(e){e.success?t.trigger("bp:message:thread:deleted",[e.data,t,i]):t.trigger("bp:message:thread:delete:failed",[e.data,t,i])}),!1}),p(document).on("click","#bp-message-send-btn",function(){var t=p(this).parents(".bp-message-write-panel"),e=t.data("nonce"),i=t.data("thread-id"),n=t.find(".bp-message-content").html();if(!(n=n.replace(/<br>|<div>/gi,"\n").replace(/<\/div>/gi,"")).length)return!1;if(t.find(".bp-message-content").html(""),i&&0!=i)return f.postReply({_wpnonce:e,thread_id:i,content:n}).then(function(e){e.success?r.trigger("bp:message:reply:posted",[e.data,r,t,d]):r.trigger("bp:message:reply:failed",[e.data,r,t])}),!1;var a=p(".send-to-input"),s=a.val().split(",");return a.val(""),f.postNewMessage({_wpnonce:e,thread_id:i,content:n,send_to:s}).then(function(e){e.success?r.trigger("bp:message:new:posted",[e.data,r,o,t,a]):r.trigger("bp:message:new:failed",[e.data,r,t])}),!1}),p(document).on("bp:message:thread:deleted",function(e,t,i,n){var a=c.find("#m-"+n);if(a.length){var s=a.next();a.remove(),s.length?u(s.data("thread-id"),s.data("nonce")):l()}else l()}))}),p(document).on("bp:message:loaded.scrollToContents",function(e,t,i,n,a){p("html,body").animate({scrollTop:n.offset().top-100},"slow")}),p(document).on("bp:message:reply:posted",function(e,t,i,n,a){p(t.contents).appendTo(i.find("#message-thread"))}),p(document).on("bp:message:new:posted",function(e,t,i,n,a,s){i.data("thread-id",t.thread_id),a.data("thread-id",t.thread_id),i.html(t.messages),n.html(t.info),p(".bp-message-send-to-holder").remove()})}(CB||{},jQuery),function(s){s(document).ready(function(){s("#send-invite-form").on("click","#invite-list input",function(){var t,n,a=s("#send-invite-form > .invite").length;s(".ajax-loader").toggle(),a&&s(this).parents("ul").find("input").prop("disabled",!0),t=s(this).val(),n=!0===s(this).prop("checked")?"invite":"uninvite",a||s(".item-list-tabs li.selected").addClass("loading"),s.post(ajaxurl,{action:"groups_invite_user",friend_action:n,_wpnonce:s("#_wpnonce_invite_uninvite_user").val(),friend_id:t,group_id:s("#group_id").val()},function(e){s("#message")&&s("#message").hide();var i="invite";a?CB.Request.getItems(i,"bp-invite-scope","bp-invite-filter",!1,1,"").done(function(e){var t=s("div."+i);t.fadeOut(100,function(){s(this).html(e),t.trigger("updated:item:list",[i,t]),s(this).fadeIn(100)}),s(".item-list-tabs li.selected").removeClass("loading")}):(s(".ajax-loader").toggle(),"invite"===n?s("#friend-list").append(e):"uninvite"===n&&s("#friend-list li#uid-"+t).remove(),s(".item-list-tabs li.selected").removeClass("loading"))})}),s("#send-invite-form").on("click","a.remove",function(){var t=s("#send-invite-form > .invite").length,n=s(this).attr("id");return s(".ajax-loader").toggle(),n=(n=n.split("-"))[1],s.post(ajaxurl,{action:"groups_invite_user",friend_action:"uninvite",_wpnonce:s("#_wpnonce_invite_uninvite_user").val(),friend_id:n,group_id:s("#group_id").val()},function(e){if(t){var i="invite";CB.Request.getItems(i,"bp-invite-scope","bp-invite-filter",!1,1,"").done(function(e){var t=s("div."+i);t.fadeOut(100,function(){s(this).html(e),t.trigger("updated:item:list",[i,t]),s(this).fadeIn(100)}),s(".item-list-tabs li.selected").removeClass("loading")})}else s(".ajax-loader").toggle(),s("#friend-list #uid-"+n).remove(),s("#invite-list #f-"+n).prop("checked",!1)}),!1})})}(jQuery),function(e,t){var i=t.Feedback||{};t.Feedback=e.extend(i,{show:function(e,t,i){},prepareText:function(e,t){return'<div class="bp-feedback bp-feedback-type-'+t+'"><p>'+e+"</p></div>"},success:function(e,t){return this.show(e,"success",t)},error:function(e,t){return this.show(e,"error",t)},notice:function(e,t){return this.show(e,"notice",t)}})}(jQuery,CB||{}),function(e,t){var i=t.Loader|{};t.Loader=e.extend(i,{show:function(e){},hide:function(e){},showGlobal:function(){},hideGlobal:function(){}})}(jQuery,CB||{});